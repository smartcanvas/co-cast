<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->



<dom-module id="cc-content-match">
  <template>
    <style>
      :host {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        display: flex;
        overflow: hidden;
        /* justify-content: center; */
        align-items: center;
        background-color: #fff;
        /* -webkit-filter: grayscale(100%); */
        color: var(--var-content-match-font-color, #000);
        opacity: 0;
        /* https://developer.mozilla.org/en/docs/Web/CSS/animation */
        animation: co-cast-container-animation var(--animation-duration, 10s) ease-in-out 0s 1 normal forwards running;
      }

      @keyframes co-cast-container-animation {
        0%   { right: -154%; left:  154%; opacity: 1; }
        5%   { right: -154%; left:  154%; opacity: 1; }
        10%  { right:    0%; left:    0%; opacity: 1; }
        90%  { right:    0%; left:    0%; opacity: 1; }
        95%  { right:  154%; left: -154%; opacity: 1; }
        100% { right:  154%; left: -154%; opacity: 1; }
      }

      :host[no-animation] {
        animation: none !important;
        opacity: 1;
      }

        .background {
          -webkit-filter: grayscale(100%);
          min-height: 100%;
          min-width: 100%;
          /* http://stackoverflow.com/a/19414020/1064325 */
          margin: auto;
          position: fixed;
          top: 0%;
          right: -200%;
          left: -200%;
          overflow: hidden;
          opacity: 0;
          /* https://developer.mozilla.org/en/docs/Web/CSS/animation */
          animation: co-cast-container-match-animation var(--animation-duration, 10s) ease-in-out 0s 1 normal forwards running;
        }

        .logo {
          overflow: hidden;
          position: absolute;
          top: 0.7em;
          right: 10%;
          max-width: 2.5em;
          min-width: 2.5em;
          width: 2.5em;
          opacity: 0;
          /* https://developer.mozilla.org/en/docs/Web/CSS/animation */
          animation: co-cast-container-match-animation var(--animation-duration, 10s) ease-in-out 0s 1 normal forwards running;
        }

        .footer {
          overflow: hidden;
          position: fixed;
          bottom: 0px;
          right: 0px;
          left: 0px;
          width: 100%;
          opacity: 0;
          /* https://developer.mozilla.org/en/docs/Web/CSS/animation */
          animation: co-cast-container-match-animation var(--animation-duration, 10s) ease-in-out 0s 1 normal forwards running;
        }

        @keyframes co-cast-container-match-animation {
          0%   { opacity: 1; }
          10%  { opacity: 1; }
          90%  { opacity: 1; }
          91%  { opacity: 0; }
          100% { opacity: 0; }
        }

        :host[no-animation] .background,
        :host[no-animation] .logo,
        :host[no-animation] .footer {
          animation: none !important;
          opacity: 1;
        }

        .container {
          width: 80%;
          margin: 0 auto;
          position: absolute;
          padding: 20px 10%;
          text-align: left;
          overflow: hidden;

          /* http://stackoverflow.com/a/28456704/1064325 */
          /* http://stackoverflow.com/a/32333332/1064325 */
          top: 50%;
          -webkit-filter: blur(0);
          transform: translateY(-50%) translateZ(0);

          opacity: 0;
          /* https://developer.mozilla.org/en/docs/Web/CSS/animation */
          animation: co-cast-container-text-animation var(--animation-duration, 10s) ease-in-out 0s 1 normal forwards running;
        }

        @keyframes co-cast-container-text-animation {
          0%   { right:  154%; left: -154%; opacity: 1; }
          5%   { right:  154%; left: -154%; opacity: 1; }
          10%  { right:    0%; left:    0%; opacity: 1; }
          90%  { right:    0%; left:    0%; opacity: 1; }
          95%  { right: -154%; left:  154%; opacity: 1; }
          100% { right: -154%; left:  154%; opacity: 1; }
        }

        :host[no-animation] .container {
          animation: none !important;
          opacity: 1;
        }

          .content-text {
            /* font-size: 100px; */
            word-wrap: break-word;
            word-break: break-word;
          }

          .match-pair {
            display: flex;
            text-align: center;
            vertical-align: middle;
            justify-content: center;
            align-items: center;
          }

          .match-avatar {
            border-radius: 50%;
            min-height: 4em;
            max-height: 4em;
            height: 4em;
            margin: 0.8em 0.5em;
            background-color: #fff;
          }

          .channel {
            font-size: 0.72em;
            font-weight: 500;
            font-family: var(--header-font-family, 'Roboto, sans-serif');
            color: var(--header-font-color, #000);
            padding: 10px 0 5px 0;
            margin: 0px;
          }

          .text {
            font-size: 0.64em;
            font-weight: 300;
            font-family: var(--var-content-match-secondary-font, 'Roboto, sans-serif');
            color: var(--var-content-match-secondary-font-color, #000);
            padding: 5px 0 10px 0;
            margin: 0px;
          }

          .header {
            font-size: 0.64em;
            font-weight: 600;
            font-family: var(--var-content-match-main-font, 'Roboto, sans-serif');
            color: var(--var-content-match-main-font-color, #000);
            padding: 10px 0 5px 0;
            margin: 0px;
          }

          .match-text {
            width: 100%;
            margin: 0 auto;
          }
    </style>
    
    <img class="background" src="../../../images/match-teamwork/background.png" />
    
    <img class="footer" src="../../../images/match-teamwork/footer.png" />
    <div class="container">
      <section class="content-text">
        <img class="logo" src="../../../images/match-teamwork/logo.png" />
        <h1 class="channel">It's a Match!</h1>
        <h2 class="text">New Business Opportunity</h2>
        <div class="match-pair">
          <img class="match-avatar" src="{{urlWithSz(content.jsonExtendedData.person1.imageURL, 300)}}" />
          <img class="match-avatar" src="{{urlWithSz(content.jsonExtendedData.person2.imageURL, 300)}}" />
        </div>
        <center class="text match-text"><strong>{{firstAndLastName(content.jsonExtendedData.person1.displayName)}}</strong> and <strong>{{firstAndLastName(content.jsonExtendedData.person2.displayName)}}</strong> will meet each other!</center>
      </section>
    </div>

  </template>
  <script>
  (function() {
    'use strict';

    Polymer({
      is: 'cc-content-match',

      properties: {
        content: {
          type: Array,
          notify: true,
          value: []
        },
        styles: {
          type: Object,
          notify: true,
          value: {}
        },
        noAnimation: {
          type: Boolean,
          notify: true,
          reflectToAttribute: true
        }
      },

      isAttached: false,
      attached: function(){
        this.isAttached = true;
        if (this.content.theme) {
          this.applyNewStyles(this.content.theme);
        }
      },

      firstAndLastName: function(name) {
        if (!name) {
          return name;
        }
        var tokens = name.split(' ');
        if (tokens.length === 1) {
          return tokens[0];
        }
        return tokens[0] + ' ' + tokens[tokens.length - 1];
      },

      urlWithSz: function(avatarURL, sz) {
        if (avatarURL) {
          var parameterSeparator;
          if (avatarURL.indexOf('?') > -1) {
            parameterSeparator = '&';
          } else {
            parameterSeparator = '?';
          }
          avatarURL += parameterSeparator + 'sz=' + sz;
        }
        return avatarURL;
      },

      fitTextToBox: function() {
          if (!this.isAttached) {
            var that = this;
            setTimeout(function() {
              that.fitTextToBox();
            }, 10);
            return;
          }

          var innerContent = this.$$('.container');
          var thresholdBox = this;
          var responsiveText = this.$$('.content-text');

          //console.log(responsiveText);
          var max = 100;
          var min = 20;
          var cur = parseInt((max + min) / 2);
          //console.log('cur > min && cur < max', cur, min, max);
          while (cur > min && cur < max) {
            //console.log('cur > min && cur < max', cur, min, max);
            responsiveText.style.fontSize = cur + 'px';

            if (innerContent.clientHeight >= thresholdBox.clientHeight - 50) {
              max = cur;
            } else {
              min = cur;
            }

            cur = parseInt((max + min) / 2);
            //console.log('cur', cur);
          }
          //console.log('responsiveText.style.fontSize', responsiveText.style.fontSize);
      },

      applyNewStyles: function(styles){
        this.customStyle['--var-content-match-main-font-color'] = styles.primaryFontColor;
        this.customStyle['--var-content-match-main-font'] = styles.primaryFont;
        this.customStyle['--var-content-match-secondary-font-color'] = styles.secondaryFontColor;
        this.customStyle['--var-content-match-secondary-font'] = styles.secondaryFont;

        this.customStyle['--header-font-family'] = styles.accentFont;
        this.customStyle['--header-font-color'] = styles.accentColor; //styles.accentFontColor;

        this.customStyle['--animation-duration'] = (parseInt(this.content.speed) / 1000) + 's';

        this.updateStyles();
      }

    });
  })();
  </script>
</dom-module>
